<div class="wallet-backdrop" (click)="close()">
  <div class="wallet-modal" (click)="$event.stopPropagation()" role="dialog" aria-modal="true">

    <header class="modal-header">
      <h1>Wallet Overview</h1>
      <button class="close-btn" (click)="close()">×</button>
    </header>

    <div class="managed-control">
      <label for="risk-select">Auto‑trade (Risk):</label>
      <select id="risk-select" [(ngModel)]="selectedRisk" aria-label="Select risk tolerance">
        <option *ngFor="let r of riskOptions" [value]="r.value">{{ r.label }}</option>
      </select>

      <button class="btn-manage" (click)="enableManaged()" [disabled]="loadingManaged">
        {{ loadingManaged ? 'Applying...' : 'Enable Auto‑trade' }}
      </button>
    </div>


    <section class="summary">
      <div class="row">
        <div class="label">Total (USDC)</div>
        <div class="value">
          {{ (walletService.totalUsd$ | async) | number:'1.2-2' }}
        </div>
      </div>

      <ng-container *ngIf="walletService.percentChange$ | async as pct">
      <div class="row">
        <div class="label">Change vs 10,000 USDC</div>
        <div class="value" [class.positive]="pct >= 0" [class.negative]="pct < 0">
        {{ pct | number:'1.2-2' }}%
        </div>
      </div>
      </ng-container>

      <div class="row">
        <div class="label">ROI</div>
        <div class="value">{{ (walletService.roi$ | async) | number:'1.2-2' }}</div>
      </div>

      <div class="wallet-worth-chart">
        <wallet-worth-chart></wallet-worth-chart>
      </div>
    </section>
    <section class="assets-section">
      <main class="asset-list">
        <h2>Assets</h2>

        <div *ngIf="(walletService.loading$ | async)" class="loading">Loading...</div>

        <ng-container *ngIf="!(walletService.loading$ | async)">
          <ul *ngIf="(walletService.assets$ | async) as assets">
            <li>
              <div class="label"><strong>Name</strong></div>
              <div class="label"><strong>Amount</strong></div>
              <div class="label"><strong>USD Value</strong></div>
              <div class="label"><strong>Profit/Loss</strong></div>
              <div class="label"><strong>Actions</strong></div>
            </li>
            <li *ngFor="let a of assets">
              <div class="asset-name">{{ a.name }}</div>
              <div class="asset-amount">{{ a.amount }}</div>
              <div class="asset-usd">$ {{ a.usdValue | number:'1.2-2' }} </div>
              <div class="asset-pnl" [class.positive]="a.pnl >= 0" [class.negative]="a.pnl < 0">
                $ {{ a.pnl | number:'1.2-2' }}
              </div>
              <button class="close-position-btn" (click)="closePosition(a.name, a.amount)">Close position</button>
            </li>
          </ul>
          <div *ngIf="walletService.assets$ | async as assets; else noAssets" class="empty"></div>
          <ng-template #noAssets>
            <div class="empty">No assets in wallet</div>
          </ng-template>
        </ng-container>
      </main>
      <aside class="asset-chart">
        <pie-chart></pie-chart>
      </aside>

    </section>

  </div>
</div>